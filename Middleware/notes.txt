Let's install the necessary dependencies:
sudo apt-get update && sudo apt-get install -y googletest lcov gcovr
sudo apt-get install -y libgtest-dev
sudo apt-get install -y google-mock

Now we need to build and install GTest from source since Ubuntu's package only installs the source files:
cd /usr/src/gtest && sudo cmake CMakeLists.txt && sudo make && sudo cp lib/*.a /usr/lib

Let's also install GMock (which comes with GTest):
cd /usr/src/googletest/googlemock && sudo cmake CMakeLists.txt && sudo make && sudo cp lib/*.a /usr/lib

mkdir build && cd build
cmake ..
make
ctest --verbose

# From build directory
lcov --capture --directory . --output-file coverage.info
lcov --remove coverage.info '/usr/*' --output-file coverage.info
genhtml coverage.info --output-directory coverage_report
